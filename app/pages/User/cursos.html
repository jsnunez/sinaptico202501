<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sinaptico - Innovaci√≥n Abierta</title>
    <link rel="stylesheet" href="styles/colores.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <link rel="stylesheet" href="styles/innovacion.css">
    <link rel="stylesheet" href="styles/clasificados.css">
    <link rel="stylesheet" href="styles/conocimiento.css">
       <link rel="stylesheet" href="styles/menu.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
    <!-- Encabezado -->
    <header>
        <div class="header">
            <div onclick="window.location.href='/helice'">
                <!-- <span class="logo-icon">‚ö°</span> -->
                <img src="/img/logo1.png" alt="SINAPTICO" class="logo" style="height:8vh;">
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="font-size:1.5em;cursor:pointer;">
                    <span id="icono-notif">üîî <span
                            style='background:red;color:white;border-radius:50%;padding:2px 7px;font-size:0.9em;'>0</span></span>
                </div>
                <div class="notificaciones" id="notificaciones"></div>


                <div class="dropdown">
                    <button id="userMenuBtn" style="display: flex; align-items: center;">
                        <div id="userPhoto ">
                            <img class="imagenPerfil" id="imagenPerfilSecundaria" src="img/sinfoto.jpg"
                                alt="Foto de perfil" onerror="this.onerror=null;this.src='img/sinfoto.jpg';">

                        </div>
                        <h3 id="nombreUsuarioHeader" style="color:white; margin-left:10px;">Usuario <i
                                class="bi bi-chevron-down"></i> </h3>
                    </button>

                    <div class="dropdown-menu" id="userMenu">
                        <a class="perfilUser" id="perfilUser">Perfil</a>
                        <a href="/miEntidad" id="habilitarMiEmpresa" style="display: none;">Empresa</a>
                        <a href="#" id="cerrarSesion">Cerrar sesi√≥n</a>
                    </div>
                </div>
            </div>
        </div>
<nav class="nav">

    <button class="nav-button" data-link="/helice" id="inicio" onclick="window.location.href='/helice'">Inicio</button>

    <div class="dropdown menuG">
        <button class="nav-button dropdown-btnG" id="directorioButton" data-link="/directorio">Directorio</button>
        <div class="dropdown-menu dropdown-menuG">
            <a href="/directorio">Entidades</a>
            <a href="/directorioPersonas">Personas</a>
        </div>
    </div>
<button class="nav-button" onclick="window.location.href='/proyectos'"  data-link="/proyectos">Proyectos</button>
    <button class="nav-button" onclick="window.location.href='/ofertaRegional'" data-link="/ofertaRegional">Oferta
        Regional</button>
    <div class="dropdown menuG">
        <button class="nav-button dropdown-btnG" data-link="/retos">Innovaci√≥n Abierta</button>
        <div class="dropdown-menu dropdown-menuG">
            <a href="/retosEmpresariales">Retos Empresariales</a>
            <a href="/retosAula">Retos de Aula</a>
        </div>
    </div>

    <div class="dropdown menuG">
        <button class="nav-button dropdown-btnG" data-link="/conocimiento">Conocimiento Abierto</button>
        <div class="dropdown-menu dropdown-menuG">
            <a href="/conocimientoCursosVirtuales" data-link="/cursosVirtuales">Cursos</a>
            <a href="/conocimientoBiblioteca" data-link="/conocimientoBiblioteca">Biblioteca</a>
        </div>
    </div>
    <button class="nav-button" onclick="window.location.href='/convocatorias'">Convocatorias</button>

    <button class="nav-button" onclick="window.location.href='/eventos'">Eventos</button>

    <button class="nav-button" id="btnEvaluador" style="display: none;" data-link="/portalEvaluadorUser"
        onclick="window.location.href='/portalEvaluadorUser'">Evaluaci√≥n</button>

</nav>

    </header>


    <!-- Challenges Section -->
    <section id="cursosSection" class="main-content" style="display: block; margin: 2rem auto 1rem;">
  
           
            <div class="section-header" style="display: flex;   justify-content: space-between;     margin-bottom: 3rem; ">
                <i class="fas fa-rocket"></i>
                <h2 style="color:white">2025 - Cursos activos</h2>
            </div>
 
        <div class="challenges-grid">

        </div>

    </section>


  <script src="/js/habilitarEvaluador.js"></script>
    <script src="/js/menu.js"></script>

    <script src="/js/config.js"></script>
    <script src="/js/cursos.js"></script>

    <!-- Ir a en construcci√≥n -->
    <script>
        function irEnConstruccion() {
            window.location.href = "/construccion"; // o la ruta que tengas
        }
        const toggleViewBtn = document.getElementById('toggleViewBtn');
        const classifiedWall = document.querySelector('.classified-wall');



        function obtenerCookie(nombre) {
            const nombreCookie = `${nombre}=`;
            const cookies = document.cookie.split(';');

            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();

                if (cookie.indexOf(nombreCookie) === 0) {
                    return cookie.substring(nombreCookie.length, cookie.length);
                }
            }
            return null; // Retorna null si no se encuentra la cookie
        }
        document.addEventListener("DOMContentLoaded", function () {
            // Ejemplo de c√≥mo leer la cookie "usuario"
            const usuario = obtenerCookie("user");
            cleanedStr = usuario.replace(/%20/g, " "); // Reemplaza '%20' por un espacio
            cleanedStr = decodeURIComponent(cleanedStr);
            document.getElementById('bienvenido').innerText = "Bienvenido  " + cleanedStr;
        });
    </script>
    <!-- Cargar cursos -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const gridContainer = document.getElementById("grid-container");
            const buscarInput = document.getElementById("buscarCurso");

            // Funci√≥n para renderizar Recursos
            function renderCursos(Recursos) {
                gridContainer.innerHTML = ""; // Limpiar contenedor
                Recursos.forEach(recurso => {
                    const card = document.createElement("div");
                    card.className = "grid-item";
                    card.innerHTML = `
                        <div class="card-recurso">
                            <h3 class="card-title">${recurso.nombre}</h3>
                            <p class="card-subtitle">${recurso.descripcion}</p>
                        <button class="action-button" onclick="window.open('recursos/${recurso.ubicacion}', '_blank')">Ver m√°s</button>

                        </div>
                    `;
                    gridContainer.appendChild(card);
                });
            }

            // Obtener Recursos desde la API
            async function cargarCursos() {
                try {
                    const res = await fetch(`/api/recurso`); // Ajusta la URL seg√∫n tu backend
                    const data = await res.json();
                    renderCursos(data);
                } catch (error) {
                    console.error("Error al cargar Recursos:", error);
                }
            }

            // Filtro de b√∫squeda
            buscarInput.addEventListener("input", async () => {
                const texto = buscarInput.value.toLowerCase();
                try {
                    const res = await fetch(`/api/recurso`);
                    const data = await res.json();
                    const filtrados = data.filter(recurso =>
                        recurso.nombre.toLowerCase().includes(texto)
                    );
                    renderCursos(filtrados);
                } catch (error) {
                    console.error("Error al filtrar Recursos:", error);
                }
            });

            // Inicializar
            cargarCursos();
        });
    </script>
    <!-- Utilidades -->
    <script>
        // =========================
        // Utilidades
        // =========================
        function obtenerCookie(nombre) {
            const nombreCookie = `${nombre}=`;
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.indexOf(nombreCookie) === 0) {
                    return cookie.substring(nombreCookie.length, cookie.length);
                }
            }
            return null;
        }

        (async () => {
            try {
                // Cargar usuario (para cabecera y foto)
                const resUser = await fetch(`/api/user/${userId}`);
                const dataUser = await resUser.json();

                document.getElementById("imagenPerfilSecundaria").src = dataUser.fotoPerfil ? "photo/" + dataUser.fotoPerfil : "photo/sinfoto.jpg";
                document.getElementById("imagenPerfil").src = dataUser.fotoPerfil ? "photo/" + dataUser.fotoPerfil : "photo/sinfoto.jpg";

            } catch (error) {
                console.error("Error al inicializar usuario:", error);
            }
        })();

    </script>

    <script>






    </script>
    <script src="js/notificaciones.js"></script>
    <script src="/js/websocket.js"></script>
    <script src="/js/menu.js"></script>
    
        <!-- Utilidades-->
    <script>
        // =========================
        // Utilidades
        // =========================
        function obtenerCookie(nombre) {
            const nombreCookie = `${nombre}=`;
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.indexOf(nombreCookie) === 0) {
                    return cookie.substring(nombreCookie.length, cookie.length);
                }
            }
            return null;
        }

        const userId = obtenerCookie("userId");

        // =========================
        // Inicializaci√≥n de usuario (nombre, foto) y carga de proyectos
        // =========================
        (async () => {
            try {
                // Cargar usuario (para cabecera y foto)
                const resUser = await fetch(`/api/user/${userId}`);
                const dataUser = await resUser.json();
                if (dataUser?.name) {

                    document.getElementById('nombreUsuarioHeader').innerText = ` ${dataUser.name.split(" ")[0]}`;
                }

                document.getElementById("imagenPerfilSecundaria").src = dataUser.fotoPerfil ? "photo/" + dataUser.fotoPerfil : "photo/sinfoto.jpg";

                if (dataUser?.fotoPerfil) {
                    const img = document.getElementById('imagenPerfil');
                    if (img) img.src = dataUser.fotoPerfil;
                }

                // Determinar entidad y setear input nombreEntidad
                let entidadId = null;
                const resUE = await fetch(`/api/usuarioempresa/user/${userId}`);
                const dataUE = await resUE.json();

                if (Array.isArray(dataUE) && dataUE.length > 0 && dataUE[0].empresa) {
                    entidadId = dataUE[0].empresa.id;
                } else {
                    entidadId = 'null';
                }

                const inputEntidad = document.getElementById('nombreEntidad');
                if (inputEntidad) inputEntidad.value = entidadId;

                console.log('Entidad ID seleccionada:', entidadId);


            } catch (err) {
                console.error('Error inicializando la vista:', err);
            }
        })();

    </script>

</body>

</html>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINAPTICO</title>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="styles/colores.css">
    <link rel="stylesheet" href="styles/stylehelice2.css">
    <link rel="stylesheet" href="styles/eventos.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>
    <!-- Fondo de animación neuronal -->
    <div class="neural-background">
        <canvas id="neuralCanvas"></canvas>
    </div>

    <!-- Encabezado -->
    <header class="header">
        <div class="logo">
            <!-- <span class="logo-icon">⚡</span> -->
            <span class="logo-text">SINAPTICO</span>
        </div>
        <nav class="nav">
            <button class="nav-button pulse" onclick="window.location.href='/helice'">Hélice</button>
            <button class="nav-button pulse" onclick="window.location.href='/innovacion'">Innovación</button>

            <button class="nav-button pulse" onclick="window.location.href='/Conocimiento'">Conocimiento</button>
            <button class="nav-button pulse" onclick="window.location.href='/eventos'">Eventos</button>

            <button class="nav-button pulse" onclick="irEnConstruccion()">Mapa</button>

            <button class="nav-button pulse" id="cerrarSesion">Cerrar sesión</button>
        </nav>
    </header>

    <!-- Bienvenida y botones de acción -->
    <div class="welcome-container">
        <div class="welcome-text">
            <h2 id="title">Convocatorias y Eventos </h2>
            <p class="subtitle">consulta las oportunidades activas para fortalece tu participacion en el ecosistema CTEI
                de santander</p>
        </div>

    </div>
    <!-- Filtros -->
    <div class="filter-container" id="filtros">
        <input type="text" id="buscarConvocatoria" placeholder="Nombre Convocatoria" class="filter-input">

        <!-- Menú desplegable para Tipo -->
        <select id="tipoFiltro" class="filter-select">
            <option value="">Todos los Tipos</option>
            <option value="1">Convocatoria</option>
            <option value="2">Eventos</option>
        </select>

        <!-- Menú desplegable para Estado -->
        <select id="estadoFiltro" class="filter-select">
            <option value="">Todos los Estados</option>
            <option value="Abierto">Abierto</option>
            <option value="Cerrado">Cerrado</option>
        </select>

        <!-- <button class="filter-button" id="filtrarBtn">Filtrar</button> -->
    </div>

    <div class="main-content" id="convocatorias">
 
    </div>
    <script src="/js/config.js"></script>

<script>
   document.getElementById("cerrarSesion").addEventListener("click", () => {
            Swal.fire({
                title: '¿Estás seguro?',
                text: '¿Querés cerrar sesión?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, cerrar sesión',
                cancelButtonText: 'Cancelar',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    // Borrar cookies y redirigir
                    document.cookie = 'jwt=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                    document.cookie = 'user=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                    document.cookie = 'userId=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                    document.location.href = "/";
                }
                // Si el usuario cancela, no pasa nada
            });
        });
     function irEnConstruccion() {
            window.location.href = "/construccion"; // o la ruta que tengas
        }
  // Función para cargar convocatorias (con o sin filtros)
  async function cargarConvocatorias(apiUrl = '/api/convocatorias') {
    try {
      const response = await fetch(apiUrl);
      const data = await response.json();

      const container = document.getElementById('convocatorias');
      container.innerHTML = '';

      if (!data.length) {
        container.innerHTML = '<p>No se encontraron convocatorias.</p>';
        return;
      }

      data.forEach((convocatoria, index) => {
        const card = document.createElement('div');
        card.classList.add('convocatorias-container');

        // Asegura que la URL externa tenga https://
        const url = convocatoria.urlConvocatoria?.startsWith('http')
          ? convocatoria.urlConvocatoria
          : `https://${convocatoria.urlConvocatoria}`;

        card.innerHTML = `
          <div class="convocatorias-card" id="convocatoria${index}">
            <div class="convocatoria-header">
              <h3 class="convocatoria-title">${convocatoria.nombre}</h3>
              <p class="convocatoria-subtitle">Financiamiento: ${convocatoria.financiamiento || 'No especificado'}</p>
              <p class="convocatoria-subtitle-color">Organizador: ${convocatoria.organizador || 'No especificado'}</p>
             <p class="convocatoria-subtitle-color">
  Fecha límite: ${convocatoria.fechaLimite 
    ? new Date(convocatoria.fechaLimite).toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' }) 
    : 'Sin fecha'}
</p>

            </div>
          </div>
          <div class="lateral-derecho">
            <div class="tipo-convocatoria">
              <span class="tipo-convocatoria-text">${convocatoria.tipoConvocatoria?.nombre || 'Tipo no asignado'}</span>
            </div>
            <a href="${url}" target="_blank" rel="noopener noreferrer" class="action-button">Ver más</a>
          </div>
        `;

        container.appendChild(card);
      });
    } catch (error) {
      console.error('Error al cargar convocatorias:', error);
      document.getElementById('convocatorias').innerHTML = '<p>Error al cargar convocatorias.</p>';
    }
  }

  // Escuchar el botón "Filtrar"
document.addEventListener('DOMContentLoaded', () => {
  cargarConvocatorias(); // Cargar todas inicialmente

  const buscarInput = document.getElementById('buscarConvocatoria');
  const tipoFiltro = document.getElementById('tipoFiltro');
  const estadoFiltro = document.getElementById('estadoFiltro');
  const filtrarBtn = document.getElementById('filtrarBtn');

  // Función para construir y cargar la URL con filtros
  function aplicarFiltros() {
    const nombre = buscarInput.value.trim();
    const tipo = tipoFiltro.value;
    const estado = estadoFiltro.value;

    const query = [];

    if (nombre) query.push(`nombre=${encodeURIComponent(nombre)}`);
    if (tipo) query.push(`tipo=${tipo}`);
    if (estado) query.push(`estado=${estado}`);

    const url = `/api/convocatorias${query.length ? '?' + query.join('&') : ''}`;
    cargarConvocatorias(url);
  }
  

  // Búsqueda automática mientras escribe
  buscarInput.addEventListener('input', () => {
    aplicarFiltros();
  });

//   // Filtrar con el botón
//   filtrarBtn.addEventListener('click', () => {
//     aplicarFiltros();
//   });

  // También podrías agregar eventos para tipo y estado si quieres que se apliquen automáticamente
  tipoFiltro.addEventListener('change', aplicarFiltros);
  estadoFiltro.addEventListener('change', aplicarFiltros);
});
</script>


</body>

</html>